<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Uƒçitelsk√Ω Editor - Dƒõjepis SRS</title>
    <style>
        :root { --primary: #1a3a5a; --accent: #e67e22; --bg: #f4f7f6; --text: #2c3e50; --danger: #e74c3c; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; }
        
        /* HEADER */
        header { background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h1 { margin: 0; font-size: 1.2rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        .top-btn-group { display: flex; gap: 10px; }
        button { cursor: pointer; padding: 8px 15px; border-radius: 6px; border: none; font-weight: bold; transition: 0.2s; }
        .btn-main { background: var(--primary); color: white; } .btn-main:hover { background: #132c45; }
        .btn-sec { background: white; border: 1px solid #ccc; color: #555; } .btn-sec:hover { background: #f0f0f0; }
        .btn-danger { background: #fff; border: 1px solid var(--danger); color: var(--danger); } .btn-danger:hover { background: var(--danger); color: white; }
        .btn-ai { background: #e6f4ea; border: 1px solid #ceead6; color: #1e8e3e; } .btn-ai:hover { background: #dceid5; }

        /* LAYOUT */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 250px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; }
        .deck-list { flex: 1; overflow-y: auto; padding: 10px; }
        .deck-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 6px; display: flex; justify-content: space-between; }
        .deck-item:hover { background: #f0f5f9; }
        .deck-item.active { background: var(--primary); color: white; }
        .sidebar-footer { padding: 15px; border-top: 1px solid #eee; display:flex; flex-direction:column; gap:10px; }

        /* MAIN CONTENT */
        .main-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        
        .deck-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; flex-wrap: wrap; gap: 10px;}
        
        .search-box { flex-grow: 1; margin: 0 20px; position: relative; }
        .search-box input { width: 100%; padding: 10px 10px 10px 35px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
        .search-box::before { content: "üîç"; position: absolute; left: 10px; top: 10px; opacity: 0.5; }

        /* TABLE */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; vertical-align: middle; }
        th { background: #f8f9fa; font-weight: 600; color: #666; font-size: 0.9rem; }
        tr:hover { background: #fdfdfd; }
        
        .col-id { width: 40px; color: #999; font-size: 0.8rem; }
        .col-img { width: 50px; text-align: center; }
        
        /* N√°hled obr√°zku v tabulce - kurzor lupa */
        .thumb { width: 35px; height: 35px; object-fit: cover; border-radius: 4px; border: 1px solid #eee; background: #eee; cursor: zoom-in; transition: transform 0.1s; }
        .thumb:hover { transform: scale(1.1); border-color: var(--primary); }
        
        .col-actions { width: 180px; text-align: right; white-space: nowrap; }
        
        .action-btn { background: none; border: none; font-size: 1.1rem; padding: 5px; opacity: 0.6; cursor: pointer; transition: 0.2s; }
        .action-btn:hover { opacity: 1; transform: scale(1.2); }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; }
        .modal { background: white; width: 600px; max-width: 90%; max-height: 90vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal-header { padding: 15px 20px; background: #f8f9fa; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; }
        .modal-body { padding: 20px; overflow-y: auto; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid #eee; text-align: right; background: #f8f9fa; }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        input[type="text"], textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: inherit; box-sizing: border-box; }
        textarea { resize: vertical; min-height: 80px; }

        .ai-box { background: #f4f7f6; padding: 15px; border-radius: 8px; border: 1px solid #ddd; font-family: monospace; font-size: 0.85rem; white-space: pre-wrap; margin-bottom: 15px; color: #333; }

        .img-drop-zone { 
            border: 2px dashed #ccc; padding: 10px; text-align: center; border-radius: 6px; 
            margin-top: 5px; cursor: pointer; transition: 0.2s; background: #fafafa;
            display: flex; align-items: center; justify-content: center; gap: 10px; min-height: 40px;
        }
        .img-drop-zone:hover { border-color: var(--primary); background: #eef4f9; }
        .preview-large { max-height: 100px; max-width: 100%; display: block; margin: 0 auto; }
        
        .hidden { display: none; }
        .status-missing { color: #ccc; font-size: 0.8rem; cursor: default; }

        /* LIGHTBOX (Zvƒõt≈°en√≠ obr√°zku) */
        .lightbox-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 2000; display: none; 
            justify-content: center; align-items: center; cursor: zoom-out;
        }
        .lightbox-img { max-width: 90%; max-height: 90%; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<header>
    <h1>üéì Uƒçitelsk√Ω Editor <span style="font-size:0.8rem; opacity:0.6; font-weight:normal;">v1.4</span></h1>
    <div class="top-btn-group">
        <button class="btn-ai" onclick="openAiModal()" title="Generovat ot√°zky pomoc√≠ AI">ü§ñ AI Prompt</button>
        <button class="btn-sec" onclick="document.getElementById('file-in').click()" title="Nahr√°t soubor z poƒç√≠taƒçe">üìÇ Nahr√°t JSON</button>
        <button class="btn-main" onclick="exportData()" title="St√°hnout soubor pro ≈æ√°ky">üíæ Ulo≈æit JSON</button>
    </div>
    <input type="file" id="file-in" accept=".json" style="display:none" onchange="importData(event)">
</header>

<div class="workspace">
    <div class="sidebar">
        <div class="deck-list" id="deck-list"></div>
        <div class="sidebar-footer">
            <button class="btn-main" style="width:100%" onclick="addNewDeck()" title="Vytvo≈ôit novou sadu ruƒçnƒõ">‚ûï Nov√© t√©ma</button>
            <button class="btn-danger" style="width:100%; font-size:0.8rem;" onclick="wipeAllData()" title="Kompletnƒõ vymazat editor">üóëÔ∏è Smazat v≈°e (Reset)</button>
        </div>
    </div>

    <div class="main-area" id="main-area">
        <div style="text-align:center; color:#999; margin-top:50px;">
            Vyberte t√©ma vlevo nebo vytvo≈ôte nov√©.
        </div>
    </div>
</div>

<div class="modal-overlay" id="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <span id="modal-title">Editace karty</span>
            <button onclick="closeModal('modal-overlay')" style="background:none; border:none; font-size:1.2rem;">‚úñ</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="edit-id">
            <div class="form-group">
                <label>Ot√°zka</label>
                <input type="text" id="edit-q" placeholder="Znƒõn√≠ ot√°zky...">
                <div class="img-drop-zone" id="zone-q" tabindex="0">
                    <span id="txt-q">üì∑ Vlo≈æit obr√°zek (Ctrl+V)</span>
                    <img id="prev-q" class="preview-large hidden">
                    <button class="btn-danger hidden" id="del-q" style="padding:2px 6px; font-size:0.7rem;">X</button>
                </div>
            </div>
            <div class="form-group">
                <label>Odpovƒõƒè (ka≈æd√Ω ≈ô√°dek = jedna odr√°≈æka)</label>
                <textarea id="edit-a" placeholder="Odpovƒõƒè..."></textarea>
                <div class="img-drop-zone" id="zone-a" tabindex="0">
                    <span id="txt-a">üì∑ Vlo≈æit obr√°zek (Ctrl+V)</span>
                    <img id="prev-a" class="preview-large hidden">
                    <button class="btn-danger hidden" id="del-a" style="padding:2px 6px; font-size:0.7rem;">X</button>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-sec" onclick="closeModal('modal-overlay')">Zru≈°it</button>
            <button class="btn-main" onclick="saveCard()">Ulo≈æit kartu</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="ai-modal">
    <div class="modal">
        <div class="modal-header">
            <span>ü§ñ Gener√°tor ot√°zek</span>
            <button onclick="closeModal('ai-modal')" style="background:none; border:none; font-size:1.2rem;">‚úñ</button>
        </div>
        <div class="modal-body">
            <p style="margin-top:0; font-size:0.9rem; color:#666;">Zkop√≠rujte, vlo≈æte do ChatGPT a dopl≈àte t√©ma.</p>
            <div class="ai-box" id="ai-prompt-text">Vytvo≈ô mi sadu 10 ot√°zek na t√©ma [DOPL≈á T√âMA] pro mou aplikaci.
V√Ωstup mus√≠ b√Ωt pouze ƒçist√Ω JSON k√≥d v n√°sleduj√≠c√≠m form√°tu:

1. Odpovƒõƒè ("a") mus√≠ b√Ωt v≈ædy pole ≈ôetƒõzc≈Ø (list).
2. P≈ôidej pr√°zdn√° pole "qImg" a "aImg".
3. Nepou≈æ√≠vej markdown.

≈†ablona:
{
  "N√°zev T√©matu": [
    {
      "q": "Ot√°zka?",
      "a": ["Odpovƒõƒè 1"],
      "qImg": "",
      "aImg": ""
    }
  ]
}</div>
        </div>
        <div class="modal-footer">
            <button class="btn-sec" onclick="closeModal('ai-modal')">Zav≈ô√≠t</button>
            <button class="btn-main" onclick="copyAiPrompt()">üìã Kop√≠rovat</button>
        </div>
    </div>
</div>

<div class="lightbox-overlay" id="lightbox" onclick="closeLightbox()">
    <img id="lightbox-img" class="lightbox-img">
</div>

<script>
    let decks = {};
    let currentDeck = null;
    let editingCardId = null;
    let tempImgQ = "";
    let tempImgA = "";
    let searchTerm = "";

    const saved = localStorage.getItem("teacher_decks_v1");
    if (saved) { try { decks = JSON.parse(saved); renderDeckList(); } catch(e) {} }

    function renderDeckList() {
        const list = document.getElementById('deck-list');
        list.innerHTML = "";
        Object.keys(decks).forEach(name => {
            const div = document.createElement('div');
            div.className = `deck-item ${currentDeck === name ? 'active' : ''}`;
            div.innerHTML = `<span>${name}</span> <span style="opacity:0.7; font-size:0.8rem;">(${decks[name].length})</span>`;
            div.onclick = () => selectDeck(name);
            list.appendChild(div);
        });
    }

    function addNewDeck() {
        const name = prompt("N√°zev nov√©ho t√©matu:");
        if (name && !decks[name]) { decks[name] = []; selectDeck(name); saveState(); }
    }

    function selectDeck(name) {
        currentDeck = name;
        searchTerm = "";
        renderDeckList();
        renderMainArea();
    }

    function deleteDeck() {
        if(confirm(`Smazat t√©ma "${currentDeck}"?`)) {
            delete decks[currentDeck];
            currentDeck = null;
            renderDeckList();
            document.getElementById('main-area').innerHTML = '<div style="text-align:center; color:#999; margin-top:50px;">Vyberte t√©ma.</div>';
            saveState();
        }
    }

    function renderMainArea() {
        if (!currentDeck) return;
        const area = document.getElementById('main-area');
        
        let html = `
            <div class="deck-header">
                <h2 style="margin:0;">${currentDeck}</h2>
                <div class="search-box"><input type="text" placeholder="Hledat ot√°zku..." value="${searchTerm}" onkeyup="handleSearch(this.value)"></div>
                <div>
                    <button class="btn-main" onclick="openModal()" title="P≈ôidat novou kartu ruƒçnƒõ">‚ûï P≈ôidat</button>
                    <button class="btn-danger" onclick="deleteDeck()" title="Smazat celou sadu">üóëÔ∏è Smazat t√©ma</button>
                </div>
            </div>
            <table><thead><tr><th class="col-id">ID</th><th class="col-img">Obr</th><th>Ot√°zka</th><th>Odpovƒõƒè</th><th class="col-img">Obr</th><th class="col-actions">Akce</th></tr></thead><tbody>
        `;
        
        decks[currentDeck].forEach((card, index) => {
            if (searchTerm && !card.q.toLowerCase().includes(searchTerm.toLowerCase())) return;
            const aText = Array.isArray(card.a) ? card.a.join(", ") : card.a;
            
            // LUPA NA OBR√ÅZKY
            const qThumb = card.qImg ? `<img src="${card.qImg}" class="thumb" onclick="showLightbox('${card.qImg}')" title="Klikni pro zvƒõt≈°en√≠">` : '<span class="status-missing">-</span>';
            const aThumb = card.aImg ? `<img src="${card.aImg}" class="thumb" onclick="showLightbox('${card.aImg}')" title="Klikni pro zvƒõt≈°en√≠">` : '<span class="status-missing">-</span>';
            
            // TOOLTIPY U TLAƒå√çTEK
            html += `<tr><td class="col-id">${index+1}</td><td class="col-img">${qThumb}</td><td>${card.q}</td><td><div style="max-height:50px; overflow:hidden;">${aText}</div></td><td class="col-img">${aThumb}</td>
            <td class="col-actions">
                <button class="action-btn" onclick="moveCard(${index}, -1)" title="Posunout nahoru">‚¨ÜÔ∏è</button>
                <button class="action-btn" onclick="moveCard(${index}, 1)" title="Posunout dol≈Ø">‚¨áÔ∏è</button>
                <button class="action-btn" onclick="duplicateCard(${index})" title="Duplikovat kartu">üìã</button>
                <button class="action-btn" onclick="openModal(${index})" title="Upravit kartu">‚úèÔ∏è</button>
                <button class="action-btn" style="color:red;" onclick="removeCard(${index})" title="Smazat kartu">üóëÔ∏è</button>
            </td></tr>`;
        });
        html += `</tbody></table>`;
        area.innerHTML = html;
        if(searchTerm) { const input = document.querySelector('.search-box input'); if(input) input.focus(); }
    }

    function handleSearch(val) { searchTerm = val; renderMainArea(); }
    function removeCard(index) { if(confirm("Smazat?")) { decks[currentDeck].splice(index, 1); renderMainArea(); renderDeckList(); saveState(); } }
    function moveCard(index, direction) {
        const newIndex = index + direction;
        if (newIndex >= 0 && newIndex < decks[currentDeck].length) {
            const arr = decks[currentDeck];
            [arr[index], arr[newIndex]] = [arr[newIndex], arr[index]];
            renderMainArea(); saveState();
        }
    }
    function duplicateCard(index) {
        const card = decks[currentDeck][index];
        const newCard = JSON.parse(JSON.stringify(card));
        newCard.id = Date.now() + Math.random(); newCard.q += " (Kopie)"; newCard.reps=0; newCard.interval=0; newCard.ef=2.5; newCard.nextReview=Date.now();
        decks[currentDeck].splice(index + 1, 0, newCard);
        renderMainArea(); renderDeckList(); saveState();
    }

    // LIGHTBOX
    function showLightbox(url) {
        document.getElementById('lightbox-img').src = url;
        document.getElementById('lightbox').style.display = 'flex';
    }
    function closeLightbox() {
        document.getElementById('lightbox').style.display = 'none';
    }

    function openModal(index = null) {
        const modal = document.getElementById('modal-overlay');
        document.getElementById('edit-q').value = ""; document.getElementById('edit-a').value = ""; tempImgQ = ""; tempImgA = ""; updatePreview('q'); updatePreview('a');
        if (index !== null) {
            editingCardId = index;
            document.getElementById('modal-title').innerText = "Upravit kartu";
            const c = decks[currentDeck][index];
            document.getElementById('edit-q').value = c.q;
            document.getElementById('edit-a').value = Array.isArray(c.a) ? c.a.join('\n') : c.a;
            tempImgQ = c.qImg || ""; tempImgA = c.aImg || "";
            updatePreview('q'); updatePreview('a');
        } else { editingCardId = null; document.getElementById('modal-title').innerText = "Nov√° karta"; }
        modal.style.display = 'flex';
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openAiModal() { document.getElementById('ai-modal').style.display = 'flex'; }
    function copyAiPrompt() { navigator.clipboard.writeText(document.getElementById('ai-prompt-text').innerText).then(() => alert("Zkop√≠rov√°no!")); }

    function saveCard() {
        const q = document.getElementById('edit-q').value.trim();
        const aVal = document.getElementById('edit-a').value.trim();
        if (!q || !aVal) { alert("Vypl≈àte v≈°e."); return; }
        const aArr = aVal.split('\n').filter(line => line.trim() !== "");
        const newCardData = { id: Date.now() + Math.random(), deck: currentDeck, q: q, a: aArr, qImg: tempImgQ, aImg: tempImgA, reps: 0, interval: 0, ef: 2.5, nextReview: Date.now() };
        if (editingCardId !== null) {
            const old = decks[currentDeck][editingCardId];
            newCardData.id = old.id; newCardData.reps = old.reps; newCardData.interval = old.interval; newCardData.ef = old.ef; newCardData.nextReview = old.nextReview;
            decks[currentDeck][editingCardId] = newCardData;
        } else { decks[currentDeck].push(newCardData); }
        closeModal('modal-overlay'); renderMainArea(); renderDeckList(); saveState();
    }

    ['q', 'a'].forEach(type => {
        const zone = document.getElementById(`zone-${type}`);
        zone.addEventListener('click', (e) => {
            if(e.target.tagName !== 'BUTTON') { const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/*'; input.onchange = e => processFile(e.target.files[0], type); input.click(); }
        });
        zone.addEventListener('paste', (e) => {
            const items = (e.clipboardData || e.originalEvent.clipboardData).items;
            for (let item of items) { if (item.type.indexOf("image") === 0) { e.preventDefault(); processFile(item.getAsFile(), type); } }
        });
        document.getElementById(`del-${type}`).onclick = (e) => { e.stopPropagation(); if (type === 'q') tempImgQ = ""; else tempImgA = ""; updatePreview(type); };
    });

    function processFile(file, type) {
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                const MAX_SIZE = 600; let width = img.width; let height = img.height;
                if (width > height) { if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; } } else { if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; } }
                canvas.width = width; canvas.height = height; ctx.drawImage(img, 0, 0, width, height);
                const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                if (type === 'q') tempImgQ = dataUrl; else tempImgA = dataUrl;
                updatePreview(type);
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }

    function updatePreview(type) {
        const url = (type === 'q') ? tempImgQ : tempImgA;
        const imgEl = document.getElementById(`prev-${type}`);
        const txtEl = document.getElementById(`txt-${type}`);
        const delBtn = document.getElementById(`del-${type}`);
        if (url) { imgEl.src = url; imgEl.classList.remove('hidden'); delBtn.classList.remove('hidden'); txtEl.classList.add('hidden'); } 
        else { imgEl.src = ""; imgEl.classList.add('hidden'); delBtn.classList.add('hidden'); txtEl.classList.remove('hidden'); }
    }

    function saveState() { localStorage.setItem("teacher_decks_v1", JSON.stringify(decks)); }
    function exportData() {
        const dataStr = JSON.stringify(decks, null, 2);
        const blob = new Blob([dataStr], {type: "application/json"});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "historie_srs.json"; a.click();
    }
    
    function importData(e) {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (v) => {
            try {
                const data = JSON.parse(v.target.result);
                const isBadData = Object.values(data).some(val => !Array.isArray(val));
                if (isBadData) { alert("Chyba: Soubor neobsahuje data kartiƒçek."); return; }
                if (Array.isArray(data)) { const name = prompt("Star√Ω form√°t. N√°zev t√©matu:"); if(name) { decks[name] = data; } } else { decks = Object.assign(decks, data); }
                saveState(); renderDeckList(); currentDeck = null; renderMainArea(); alert("Naƒçteno!");
            } catch (err) { alert("Chyba souboru JSON."); }
        };
        reader.readAsText(file);
    }

    function wipeAllData() {
        if(confirm("OPRAVDU SMAZAT V≈†ECHNA DATA V EDITORU?\n(Tuto akci nelze vr√°tit)")) {
            localStorage.removeItem("teacher_decks_v1");
            location.reload();
        }
    }
</script>
</body>
</html>